<?xml version="1.0" encoding="utf-8"?>
<stylesheet id="styluLM5dKCKnOeS" lang="any" show-in="main" webpalschematype="wpAppStylesheet"><![CDATA[<?xml version="1.0"?>
<!DOCTYPE xsl:stylesheet [
<!ENTITY nbsp "&#160;" >
]>

<!-- (c) 2001-present All Copyrights Palomino System Innovations Inc.
Illegal reproduction and disclosure will be prosecuted  -->

<xsl:stylesheet
version="1.0"
xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
xmlns:wp="http://www.palominosys.com/wp"
xmlns:php="http://php.net/xsl"
xmlns:date="http://exslt.org/dates-and-times"
xmlns:exsl="http://exslt.org/common"
extension-element-prefixes="exsl"
>

<xsl:template name="newslistWidget">  
	<xsl:param name="node-name"/>
	<xsl:param name="max-items"/>
	<xsl:param name="enable-view-all-link" />
	<xsl:param name="enable-individual-page" />
	<xsl:param name="sort-latest" />
	<xsl:param name="layout" />
	<xsl:param name="view-all-link-text" />
	<xsl:param name="get-archived" />
	<xsl:param name="enable-pagination" />
	
	<!-- <div class="widget iminBody-content"> -->
	<div class="widget">
	  
	  <!-- if widget exists -->
	  <xsl:choose>
		<xsl:when test="//newslist[@name=$node-name]">
		  <!--<xsl:copy-of select="newslist[@name=$node-name]" />-->
		  
		  <xsl:variable name="chapter_id" select="//newslist[@name=$node-name]/../@id"/>
		  <xsl:variable name="path">
			<xsl:call-template name="create_xpath_to_node">
			  <xsl:with-param name="node_id" select="$chapter_id"/>
			  <xsl:with-param name="web_root" select="//pages"/>
			</xsl:call-template>
		  </xsl:variable>
		  <xsl:variable name="news-base-link">
			<xsl:choose>
			  <xsl:when test="$enable-individual-page">
<!-- 				<xsl:value-of select="concat('?path=',$path)"/> -->
<!--                 <xsl:value-of select="concat('?path=', '/Investors/news')"/> -->
                <xsl:text>/our-company/investors</xsl:text>
			  </xsl:when>
			  <xsl:otherwise>
				<xsl:value-of select="''"/>
			  </xsl:otherwise>
			</xsl:choose>
		  </xsl:variable>
		  <xsl:variable name="my-layout">
			<xsl:choose>
			  <xsl:when test="$layout">
				<xsl:value-of select="$layout" />
			  </xsl:when>
			  <xsl:otherwise>
				<xsl:value-of select="'title-date'"/>
			  </xsl:otherwise>
			</xsl:choose>
		  </xsl:variable>
		  
		  <xsl:variable name="my-max-items">
			<xsl:choose>
			  <xsl:when test="not($max-items) or $max-items=''">
<!-- 				<xsl:value-of select="number(4)"/> -->
                <xsl:value-of select="number(8)"/>
			  </xsl:when>
			  <xsl:otherwise>
				<xsl:value-of select="$max-items"/>
			  </xsl:otherwise>
			</xsl:choose>
		  </xsl:variable>
		  
		  <!-- get a new newslist node with new attributes for easier styling -->
		  <xsl:variable name="new-newslist-tree">
			<xsl:apply-templates select="//newslist[@name=$node-name]" mode="pre-process">
			  <xsl:with-param name="max-items" select="$my-max-items"/>
			  <xsl:with-param name="index" select="'list-all'"/>
			  <xsl:with-param name="news-base-link" select="$news-base-link"/>
			  <xsl:with-param name="get-archived" select="$get-archived"/>
			</xsl:apply-templates>
		  </xsl:variable>
		  <xsl:variable name="new-newslist" select="exsl:node-set($new-newslist-tree)/newslist"/>
		  
		  <!--
		  <xsl:value-of select="$chapter_id"/>
		  <xsl:value-of select="$path" />
		  -->
		  
		  <!-- beginning of event list -->
		  <xsl:text disable-output-escaping="yes">&lt;ul id="newsWidget </xsl:text>
		  <xsl:value-of select="$new-newslist/@name"/>
		  <xsl:text disable-output-escaping="yes">" style="</xsl:text>
		  
		  <xsl:text disable-output-escaping="yes">list-style:none; padding-left:0px;"&gt;</xsl:text>
		  
		  <xsl:choose>
			<xsl:when test="$sort-latest">
			  <xsl:apply-templates select="$new-newslist/news" mode="page">
				<xsl:sort order="descending" select="./@date"/>
				<xsl:with-param name="max-items" select="$my-max-items"/>
				<xsl:with-param name="items-per-page" select="number(3)"/>
				<xsl:with-param name="number-of-pages" select="number(1)"/>
				<xsl:with-param name="layout" select="$my-layout"/>
				<xsl:with-param name="date-format" select="$new-newslist/@date-format"/>
			  </xsl:apply-templates>
			</xsl:when>
			<xsl:otherwise>
			  <xsl:apply-templates select="$new-newslist/news" mode="page">
				<xsl:with-param name="max-items" select="$my-max-items"/>
				<xsl:with-param name="items-per-page" select="number(3)"/>
				<xsl:with-param name="number-of-pages" select="number(1)"/>
				<xsl:with-param name="layout" select="$my-layout"/>
				<xsl:with-param name="date-format" select="$new-newslist/@date-format"/>
			  </xsl:apply-templates>
			</xsl:otherwise>
		  </xsl:choose>
		  
		  <xsl:text disable-output-escaping="yes">&lt;/ul&gt;</xsl:text>
		  <!-- end of event list -->
		  
		  <xsl:if test="$path!='' and $enable-view-all-link">
			<!-- beginning of view all link -->
			<a>
			  <xsl:text disable-output-escaping="yes">&lt;a href="</xsl:text>
			  <xsl:value-of select="concat('?path=',$path)"/>
			  <xsl:text disable-output-escaping="yes">" class="btn btn-primary"&gt;</xsl:text>
			  <xsl:choose>
				<xsl:when test="$view-all-link-text">
				  <xsl:value-of select="$view-all-link-text" />
				</xsl:when>
				<xsl:otherwise>
				  View all items
				</xsl:otherwise>
			  </xsl:choose>
			  <i class="fa fa-chevron-right"></i>
			  <xsl:text disable-output-escaping="yes">&lt;/a&gt;</xsl:text>
			</a>
			
			<!-- end of view all link -->
		  </xsl:if>
		</xsl:when>
		<xsl:otherwise>
		  
		  <div class="error">Widget not found.</div>
		  
		</xsl:otherwise>
	  </xsl:choose>
	  <!-- end if widget exists -->
	  
	</div>
  </xsl:template>

</xsl:stylesheet>]]></stylesheet>
